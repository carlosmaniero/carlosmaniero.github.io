<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>    PHP - Long Polling - 
Dev Diary</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="imagetoolbar" content="no">
    <meta http-equiv="pragma" content="cache">
    <meta http-equiv="cache-control" content="cache">
    <meta http-equiv="vary" content="content-language">
    <meta http-equiv="Cache-control" content="max-age=2592000, public">
    <meta http-equiv="content-style-type" content="text/css">
    <link rel="stylesheet" type="text/css" href="/theme/css/screen.min.css">
    <link rel="stylesheet" type="text/css" href="/theme/css/highlight.min.css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="publisher" href="">
    <link rel="apple-touch-startup-image" href="/theme/images/logo.png">
    <link type="text/plain" rel="socialmedia" href="/socialmedia.txt">
    <link rel="dns-prefetch" href=""/>
    <link rel="dns-prefetch" href="//www.gstatic.com"/>
    <link rel="dns-prefetch" href="//fonts.gstatic.com"/>
    <link rel="dns-prefetch" href="//fonts.googleapis.com"/>
    <link rel="dns-prefetch" href="//accounts.google.com"/>
    <link rel="dns-prefetch" href="//ssl.google-analytics.com"/>
    <link rel="dns-prefetch" href="//www.google-analytics.com"/>
    <link rel="dns-prefetch" href="//googleads.g.doubleclick.net"/>
    <link rel="dns-prefetch" href="//twemoji.maxcdn.com"/>
    <link rel="dns-prefetch" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400"/>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="application-name" content="Dev Diary"/>
    <meta name="msapplication-starturl" content="http:"/>
    <meta name="msapplication-tooltip" content=""/>
    <meta name="msapplication-window" content="width=1024;height=768"/>
    <meta name="msapplication-task" content="name=Dev Diary;action-uri=http:;icon-uri=/theme/images/favicon.ico"/>
    <meta name="msapplication-TileImage" content="/theme/images/apple-touch-icon-144x144.png"/>
    <meta name="msapplication-TileColor" content="#1F1F21"/>
    <meta name="application-name" content="Dev Diary">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content="">
    <meta name="alexaVerifyID" content=""/>
    <meta name="wot-verification" content=""/>
    <meta name="msvalidate.01" content="" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="medium" content="mult">
    <meta name="adblock" content="disable">
    <meta name="rating" content="General">
    <meta name="resource-type" content="document">
    <meta name="revisit-after" content="1 days">
    <meta name="revisit" content="1">
    <meta name="robots" content="index,follow">
    <meta name="no-email-collection" content="http://www.unspam.com/noemailcollection/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@carlosmaniero">
    <meta property="og:site_name" content="Dev Diary">
    <meta property="og:locale" content="en">
    <link rel="canonical" href="/php-long-polling.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="PHP - Long Polling">
    <meta property="og:url" content="php-long-polling.html">
    <meta property="og:description" content="Long Polling is a technique used when you need create a real time application, where the server will wait from a event occur to response the request. On this example, we will create a webchat, using a simple text file. The server will read the text file, and will hold ...">
    <meta property="article:published_time" content="Wednesday, July 18, 2012">
    <meta name="twitter:title" content="PHP - Long Polling">
    <meta name="twitter:description" content="Long Polling is a technique used when you need create a real time application, where the server will wait from a event occur to response the request. On this example, we will create a webchat, using a simple text file. The server will read the text file, and will hold ...">
    <meta name="description" content="Long Polling is a technique used when you need create a real time application, where the server will wait from a event occur to response the request. On this example, we will create a webchat, using a simple text file. The server will read the text file, and will hold ...">
    <meta name="twitter:creator" content="@carlosmaniero">
    <meta property="og:image" content="/theme/images/logo.png">
    <meta name="twitter:image" content="/theme/images/logo.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="300">
    <meta property="og:image:height" content="300">
    <meta property="article:section" content="Old Posts">
    <meta property="article:tag" content="PHP">
    <meta property="article:author" content="Carlos Maniero">
    <script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-73329109-1', 'auto');ga('send', 'pageview');var _qevents = _qevents || [];setTimeout(function() { window.onscroll = function() { window.onscroll = null;
        ga('send','event','Ajuste de Tasa de Rebote','Scroll despues de 5 segundos');}}, 5000);</script>
    <script src="//twemoji.maxcdn.com/twemoji.min.js"></script>
</head>
<body class="post-template nav-closed" itemscope itemtype="http://schema.org/WebPage">
    <meta itemprop="name" content="Dev Diary">
    <meta itemprop="url" content="">
    <meta itemprop="headline" content="Dev Diary || ">
    <meta itemprop="description about" content="">
    <meta itemprop="keywords" content="">
    <meta itemprop="inLanguage" content="en">
<nav class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul role="menubar">
        <li class="" role="presentation"><a  href="/index.html" title="Dev Diary" itemprop="name" itemprop="significantLink">Home</a></li>
            <li role="presentation"><a  href="http://github.com/carlosmaniero" title="GitHub" itemprop="name" itemprop="significantLink">GitHub</a></li>
            <li role="presentation"><a  href="http://facebook.com/carlosmaniero" title="Facebook" itemprop="name" itemprop="significantLink">Facebook</a></li>
            <li role="presentation"><a  href="http://twitter.com/carlosmaniero" title="Twitter" itemprop="name" itemprop="significantLink">Twitter</a></li>
            <li class="" role="presentation"><a  href="/archives.html" title="Dev Diary | Archives" itemprop="name" itemprop="significantLink">Archives</a></li>
    </ul>
</nav>
<span class="nav-cover"></span>    <div class="site-wrapper">
        <header class="main-header post-head" style="background-image: url('/');" itemscope itemtype="http://schema.org/WPHeader">
            <nav class="main-nav overlay clearfix">
                <a class="menu-button" href="#">
                    <span class="burger">&#9776;</span>
                    <span class="word">Menu</span>
                </a>
            </nav>
            <div class="vertical">
                <div class="main-header-content inner">
    <h1 class="page-title" itemprop="headline">PHP - Long Polling</h1>
                </div>
            </div>
        </header>
<main id="content" class="content" role="main">
    <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
        <header class="post-header">
            <h1 class="post-title hidden" itemprop="headline">PHP - Long Polling</h1>
            <section class="post-meta">
                <time class="post-date" itemprop="datePublished" datetime="2012YYY-25M-%DD">Wednesday, July 18, 2012</time>
                on <a href="tag/php.html">Php</a>            </section>
        </header>
        <section class="post-content">
            <p>Long Polling is a technique used when you need create a real time application,
where the server will wait from a event occur to response the request.</p>
<p>On this example, we will create a webchat, using a simple text file.
The server will read the text file,
and will hold the conection until the file has new lines.
To check it, the server will receive the current line number.</p>
<p>Go to the code</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// Disable max runtime</span>
<span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">function</span> <span class="nf">poll</span><span class="p">(</span><span class="nv">$cur_line</span><span class="p">){</span>    
    <span class="c1">// An infinite loop</span>
    <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">){</span>    
        <span class="c1">// Read the file</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;chat.txt&#39;</span><span class="p">);</span>
        <span class="nv">$lines</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$lines</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$cur_line</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])){</span>
            <span class="c1">// Sleep for 1 seccond if no new line</span>
            <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> 
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$ret</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
            <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
            <span class="c1">// Put new lines in the vector</span>
            <span class="k">for</span><span class="p">(</span><span class="nv">$cur_line</span><span class="p">;</span> <span class="nv">$cur_line</span> <span class="o">&lt;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$lines</span><span class="p">);</span> <span class="nv">$cur_line</span><span class="o">++</span><span class="p">){</span>
                <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$lines</span><span class="p">[</span><span class="nv">$cur_line</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="c1">// Update the cur_line to response</span>
            <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;cur_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$cur_line</span><span class="p">;</span>
            <span class="c1">// Return an JSON</span>
            <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// echo the result</span>
<span class="k">echo</span> <span class="nx">poll</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;cur_line&#39;</span><span class="p">]);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>You can see the complete code <a href="https://github.com/carlosmaniero/Php-long-polling">here</a></p>
<hr />
<h4>Old Post</h4>
<p>This is an old post migrated from my old blog. 
You can see the original content <a href="http://carlosmaniero.blogspot.com.br/2012/07/php-long-polling.html">here</a>[pt-br]</p>
        </section>
        <footer class="post-footer">
            <figure class="author-image">
                <a class="img" href="author/carlos-maniero.html" style="background-image: url('https://avatars0.githubusercontent.com/u/2002011?v=3&s=460')"><span class="hidden">Carlos Maniero's Picture</span></a>
            </figure>
            <section class="author">
                <h4>
                    <a href="author/carlos-maniero.html">Carlos Maniero</a>
                </h4>
                <p>Python Developer and an open source evangelist. Focused in web  development. Working with Django and Tornado for async web solutions. A lover of the Linux terminal and the creator of the Pygamii, an ascii game engine written in Python.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">São Paulo/Brazil</span>
                </div>
            </section>
            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=PHP%20-%20Long%20Polling%20via%20%40carlosmaniero&amp;url=/php-long-polling.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=/php-long-polling.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=/php-long-polling.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
<section>
<h2>Comments !</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">var disqus_identifier = "php-long-polling.html";(function(){var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//carlosmaniero-github-io.disqus.com.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script>
</section>        </footer>
    </article>
</main>
<aside class="read-next">
</aside>        <footer class="site-footer clearfix" role="contentinfo" itemscope itemtype="http://schema.org/WPFooter">
            <section class="copyright">
                <a itemprop="url" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
                    CC Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
                </section>
                <section class="poweredby">
                    Proudly published with 
                    <a itemprop="url" href="https://getpelican.org" target="_blank">Pelican</a>
                </section>
            </section>
        </footer>
    </div>
    <script type="text/javascript" src="/theme/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="/theme/js/jquery.fitvids.min.js"></script>
    <script type="text/javascript" src="/theme/js/index.min.js"></script>
    <script>twemoji.parse(document, {"size":16});</script>
</body>
</html>